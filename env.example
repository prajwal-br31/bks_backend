# ============================================
# BASH BOOKKEEPING - BACKEND ENVIRONMENT VARIABLES
# ============================================
# Rename this file to .env and fill in your values
# Windows: rename env.example .env
# Linux/Mac: mv env.example .env

# ============================================
# CORE SETTINGS
# ============================================
PROJECT_NAME=Bash Bookkeeping API
API_V1_PREFIX=/api/v1

# ============================================
# DATABASE (Required)
# ============================================
# Local development
DATABASE_URL=postgresql+psycopg2://postgres:postgres@localhost:5432/bash

# Production examples:
# Azure SQL Database: mssql+pyodbc://user:password@your-server.database.windows.net:1433/bash?driver=ODBC+Driver+18+for+SQL+Server
# Azure PostgreSQL: postgresql+psycopg2://user:password@your-server.postgres.database.azure.com:5432/bash?sslmode=require
# Supabase: postgresql+psycopg2://postgres:password@db.xxxxx.supabase.co:5432/postgres

# ============================================
# OPENAI / AZURE OPENAI (Optional - for AI features)
# ============================================
# Standard OpenAI
OPENAI_API_KEY=sk-your-openai-api-key-here

# --- Azure OpenAI Service ---
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_KEY=your-azure-openai-key
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# ============================================
# EMAIL INGESTION
# ============================================
# Provider: "imap", "gmail", or "microsoft_graph"
EMAIL_PROVIDER=imap

# --- IMAP Configuration (Gmail, Outlook, etc.) ---
IMAP_HOST=imap.gmail.com
IMAP_PORT=993
IMAP_USERNAME=your-email@gmail.com
# For Gmail: Use App Password (https://myaccount.google.com/apppasswords)
IMAP_PASSWORD=your-app-password
IMAP_USE_SSL=true
IMAP_FOLDER=INBOX

# --- Gmail API Configuration (OAuth2) ---
# Get from Google Cloud Console: https://console.cloud.google.com/
GMAIL_CLIENT_ID=your-client-id.apps.googleusercontent.com
GMAIL_CLIENT_SECRET=your-client-secret
GMAIL_REFRESH_TOKEN=your-refresh-token
GMAIL_LABEL=invoices

# --- Microsoft Graph API (Outlook/Office 365) ---
# Get from Azure Portal: https://portal.azure.com/ → App registrations
MICROSOFT_TENANT_ID=your-tenant-id
MICROSOFT_CLIENT_ID=your-client-id
MICROSOFT_CLIENT_SECRET=your-client-secret
MICROSOFT_USER_EMAIL=your-email@yourdomain.com

# --- Email Polling Settings ---
EMAIL_POLL_INTERVAL_SECONDS=30
# Comma-separated list of trusted domains
EMAIL_WHITELIST_DOMAINS=trusted-vendor.com,supplier.com
# Comma-separated list of trusted email addresses
EMAIL_WHITELIST_ADDRESSES=invoices@vendor.com,billing@supplier.com

# ============================================
# OCR (Document Processing)
# ============================================
# Provider: "tesseract", "google_vision", or "azure_form_recognizer"
OCR_PROVIDER=tesseract

# --- Google Vision (if OCR_PROVIDER=google_vision) ---
# Paste your service account JSON (single line, escaped)
GOOGLE_CLOUD_CREDENTIALS_JSON=

# --- Azure AI Document Intelligence / Form Recognizer (if OCR_PROVIDER=azure_form_recognizer) ---
# Get from Azure Portal: https://portal.azure.com/ → Cognitive Services
AZURE_FORM_RECOGNIZER_ENDPOINT=https://your-resource.cognitiveservices.azure.com/
AZURE_FORM_RECOGNIZER_KEY=your-form-recognizer-key

# ============================================
# OBJECT STORAGE - Required
# ============================================
# Provider: "azure_blob" or "s3_compatible"
STORAGE_PROVIDER=azure_blob

# --- Azure Blob Storage (Recommended for Azure) ---
# Get from Azure Portal: Storage accounts → Access keys
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=youraccount;AccountKey=yourkey;EndpointSuffix=core.windows.net
AZURE_STORAGE_CONTAINER_NAME=bookkeeping-documents

# --- Alternative: Azure Storage with SAS Token ---
AZURE_STORAGE_ACCOUNT_NAME=yourstorageaccount
AZURE_STORAGE_ACCOUNT_KEY=your-storage-account-key
# Or use SAS Token:
# AZURE_STORAGE_SAS_TOKEN=your-sas-token

# --- S3-Compatible Storage (Alternative) ---
# If you prefer S3-compatible storage, set STORAGE_PROVIDER=s3_compatible
S3_ENDPOINT_URL=https://s3.amazonaws.com
S3_ACCESS_KEY=your-access-key
S3_SECRET_KEY=your-secret-key
S3_BUCKET_NAME=bookkeeping-documents
S3_REGION=us-east-1

# --- Other S3-Compatible Services ---
# MinIO (self-hosted):
# S3_ENDPOINT_URL=http://localhost:9000

# DigitalOcean Spaces:
# S3_ENDPOINT_URL=https://nyc3.digitaloceanspaces.com

# Cloudflare R2:
# S3_ENDPOINT_URL=https://YOUR_ACCOUNT_ID.r2.cloudflarestorage.com

# ============================================
# REDIS + CELERY (Required for background tasks)
# ============================================
# Local development
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# --- Azure Cache for Redis ---
# Get from Azure Portal: Azure Cache for Redis → Access keys
# REDIS_URL=rediss://:your-access-key@your-cache.redis.cache.windows.net:6380/0

# --- Upstash (serverless Redis) ---
# REDIS_URL=rediss://default:your-password@your-upstash-endpoint:6379

# ============================================
# SECURITY (Virus Scanning)
# ============================================
# Options: "clamav", "azure_defender", or "none"
VIRUS_SCANNER=clamav
CLAMAV_HOST=localhost
CLAMAV_PORT=3310

# --- Azure Defender for Storage (if VIRUS_SCANNER=azure_defender) ---
# Automatically enabled when using Azure Blob Storage with Defender enabled

# ============================================
# CLASSIFICATION SETTINGS
# ============================================
# Minimum confidence score (0.0-1.0) for auto-classification
CLASSIFICATION_CONFIDENCE_THRESHOLD=0.75
# Auto-post invoices to accounting (use with caution)
AUTO_POST_MODE=false

# ============================================
# WEBSOCKET (Real-time notifications)
# ============================================
WEBSOCKET_ENABLED=true

# --- Azure Web PubSub (for scalable WebSockets) ---
AZURE_WEB_PUBSUB_CONNECTION_STRING=Endpoint=https://your-pubsub.webpubsub.azure.com;AccessKey=yourkey;Version=1.0;

# ============================================
# AZURE APPLICATION INSIGHTS (Monitoring)
# ============================================
# Optional - for logging and monitoring
APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=your-key;IngestionEndpoint=https://region.in.applicationinsights.azure.com/

# ============================================
# CORS (Add your frontend domains)
# ============================================
# Handled in main.py - update allowed origins for production


